{% extends "form_generico.html"%}
{% load static %}
{% load widget_tweaks %}
{% block form %}


    <!-- id_repuesto con modal -->
    <div class="form-group mb-3">
        <label for="{{ form.id_repuesto.id_for_label }}">Repuesto:</label>
        <div class="input-group">
            {{ form.id_repuesto }}
            <div class="input-group-append">
                <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#modal-id_repuesto">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
    </div>
    <!-- Id Tipo Mantenimiento con modal -->
    <div class="form-group mb-3">
        <label for="{{ form.id_tipo_mantenimiento.id_for_label }}">Tipo Mantenimiento:</label>
        <div class="input-group">
            {{ form.id_tipo_mantenimiento }}
            <div class="input-group-append">
                <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#modal-id_tipo_mantenimiento">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>
    </div>

        <!-- Id insumos con modal -->
    <div class="form-group mb-3">
        <label for="{{ form.id_insumos.id_for_label }}">Insumo:</label>
        <div class="input-group">
            {{ form.id_insumos }}
            <div class="input-group-append">
                <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#modal-id_insumos">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>
    </div>


     <div class="modal fade" id="modal-id_repuesto" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Crear Repuesto</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Aqu√≠ se cargar√° el form por AJAX -->
            </div>
            </div>
        </div>
    </div>
<!-- En tu template principal -->
   <script>
// Script mejorado con manejo de errores
$(document).ready(function() {
    console.log("‚úÖ Documento listo, configurando modal...");
    
    $(".modal#modal-id_repuesto").on("show.bs.modal", function(e){
        console.log("üîç Modal de repuestos se est√° abriendo...");
        var modal = $(this);
        
        $.ajax({
            url: "{% url 'apy:detallerepuesto_modal_crear' %}",
            type: 'GET',
            headers: {'X-Requested-With': 'XMLHttpRequest'},
            beforeSend: function() {
                console.log("üîÑ Cargando formulario...");
                modal.find('.modal-content').html(
                    '<div class="modal-body text-center py-4">' +
                    '<div class="spinner-border text-primary" role="status">' +
                    '<span class="sr-only">Cargando...</span>' +
                    '</div>' +
                    '<p class="mt-2">Cargando formulario...</p>' +
                    '</div>'
                );
            },
            success: function(data){
                console.log("‚úÖ Formulario cargado exitosamente");
                if (data.html) {
                    modal.find(".modal-content").html(data.html);
                } else {
                    console.error("‚ùå No se recibi√≥ HTML en la respuesta");
                    modal.find('.modal-content').html(
                        '<div class="modal-header">' +
                        '<h5 class="modal-title">Error</h5>' +
                        '<button type="button" class="close" data-dismiss="modal">&times;</button>' +
                        '</div>' +
                        '<div class="modal-body">' +
                        '<div class="alert alert-danger">Error: No se pudo cargar el formulario</div>' +
                        '</div>'
                    );
                }
            },
            error: function(xhr, status, error) {
                console.error("‚ùå Error AJAX:", status, error);
                modal.find('.modal-content').html(
                    '<div class="modal-header">' +
                    '<h5 class="modal-title">Error</h5>' +
                    '<button type="button" class="close" data-dismiss="modal">&times;</button>' +
                    '</div>' +
                    '<div class="modal-body">' +
                    '<div class="alert alert-danger">Error al cargar el formulario: ' + error + '</div>' +
                    '</div>'
                );
            }
        });
    });
});
</script>

        <!-- Modal Mantenimiento -->
    <!-- Modal Tipo Mantenimiento -->
    <div class="modal fade" id="modal-id_tipo_mantenimiento" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Crear Tipo Mantenimiento</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Aqu√≠ se cargar√° el form por AJAX -->
            </div>
            </div>
        </div>
    </div>
        <!-- Script tipo de Mantenimiento. -->
    <script>
        $("#modal-id_tipo_mantenimiento").on("show.bs.modal", function(){
            var modal = $(this);
            $.ajax({
                url: "{% url 'apy:detallemantenimiento_modal_crear' %}",
                success: function(data){
                    modal.find(".modal-body").html(data.html || data);
                }
            });
        });
    </script>

        <!-- Modal insumos -->
    <div class="modal fade" id="modal-id_insumos" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Crear Insumo</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Aqu√≠ se cargar√° el form por AJAX -->
            </div>
            </div>
        </div>
    </div>
            <script>
        $("#modal-id_insumos").on("show.bs.modal", function(){
            var modal = $(this);
            $.ajax({
                url: "{% url 'apy:detalleinsumos_modal_crear' %}",
                success: function(data){
                    modal.find(".modal-body").html(data.html || data);
                }
            });
        });
    </script>





{% endblock %}