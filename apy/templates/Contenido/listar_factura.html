{% extends "generic_listar.html" %}
{% load humanize %}
{% load static %}

{% block titulo %}
    <h1 class="text-center">Lista de Facturas</h1>
{% endblock titulo %}

{% block agregar %}
<a href="{{crear_url}}" class="btn btn-primary btn-xs">
    <i class="fas fa-plus"></i> Agregar
</a>
{% endblock %}

{% block columnas %}
    <th>ID</th>
    <th>Fecha</th>
    <th>Empresa</th>
    <th>Detalle Servicio</th>
    <th>Empleado</th>
    <th>Cliente</th>
    <th>Método de Pago</th>
    <th>Acciones</th>
{% endblock %}

{% block iterar %}
    {% for f in object_list %}
    <tr>
        <!-- Campo correcto según tu modelo -->
        <td>{{ f.id }}</td>
        
        <!-- Fecha - con formato -->
        <td>
            {% if f.Fecha %}
                {{ f.Fecha|date:"d/m/Y" }}
            {% else %}
                <span class="text-muted">No especificada</span>
            {% endif %}
        </td>
        
        <!-- Empresa -->
        <td>
            {% if f.id_empresa %}
                {{ f.id_empresa.nombre }}
            {% else %}
                <span class="text-muted">Sin empresa</span>
            {% endif %}
        </td>
        
        <!-- Detalle Servicio -->
        <td>
            {% if f.id_Detalles_servicios %}
                Detalle #{{ f.id_Detalles_servicios.id }}
            {% else %}
                <span class="text-muted">Sin detalle</span>
            {% endif %}
        </td>
        
        <!-- Empleado -->
        <td>
            {% if f.id_empleado %}
                {{ f.id_empleado.nombre }}
            {% else %}
                <span class="text-muted">Sin empleado</span>
            {% endif %}
        </td>
        
        <!-- Cliente -->
        <td>
            {% if f.id_cliente %}
                {{ f.id_cliente.nombre }} 
                <small class="text-muted">({{ f.id_cliente.identificacion }})</small>
            {% else %}
                <span class="text-muted">Sin cliente</span>
            {% endif %}
        </td>
        
        <!-- Método de Pago -->
        <td>
            {% if f.metodo_pago %}
                <span class="badge 
                    {% if f.metodo_pago == 'efectivo' %}bg-success
                    {% elif f.metodo_pago == 'transferencia' %}bg-primary
                    {% else %}bg-secondary{% endif %}">
                    {{ f.get_metodo_pago_display }}
                </span>
            {% else %}
                <span class="text-muted">No especificado</span>
            {% endif %}
        </td>
        
        <!-- Acciones -->
        <td>
            <div class="btn-group" role="group">
                <a href="{% url 'apy:factura_editar' f.id %}" 
                   class="btn btn-warning btn-sm" 
                   title="Editar factura">
                    <i class="fas fa-edit"></i>
                </a>
                <a href="{% url 'apy:factura_eliminar' f.id %}" 
                   class="btn btn-danger btn-sm" 
                   title="Eliminar factura"
                   onclick="return confirm('¿Está seguro de eliminar esta factura?');">
                    <i class="fas fa-trash-alt"></i>
                </a>
                
            </div>
        </td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="8" class="text-center text-muted py-4">
            <i class="fas fa-file-invoice fa-2x mb-2"></i><br>
            No hay facturas registradas
        </td>
    </tr>
    {% endfor %}
{% endblock %}

{% block javascript %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  {% if messages %}
    {% for message in messages %}
      Swal.fire({
        icon: '{% if "success" in message.tags %}success{% elif "error" in message.tags %}error{% else %}info{% endif %}',
        title: '{{ message|escapejs }}',
        timer: 2500,
        showConfirmButton: false
      });
    {% endfor %}
  {% endif %}
</script>
{% endblock %}