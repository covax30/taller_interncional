{% extends 'body.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h2>Gesti贸n de Permisos del Usuario</h2>
  <form method="post">
    {% csrf_token %}
    
    <div class="card">
      <div class="card-body">

        <!-- Selecci贸n de usuario -->
        <div class="row mb-3">
          <label for="id_user" class="col-sm-2 col-form-label">Usuario</label>
          <div class="col-sm-10">
            <select name="user" class="form-control" id="id_user">
              {% for user in users %}
                <option value="{{ user.id }}" {% if user.id == form.user.value %}selected{% endif %}>
                  {{ user.username }}
                </option>
              {% endfor %}
            </select>
          </div>
        </div>

        <!-- Tabla de permisos con switches -->
        <div class="table-responsive">
          <table class="table table-bordered table-hover">
            <thead class="table-light">
              <tr>
                <th>M贸dulo</th>
                <th>Ver</th>
                <th>Crear</th>
                <th>Editar</th>
                <th>Eliminar</th>
              </tr>
            </thead>
            <tbody>
              {% for module in modules %}
              <tr>
                <td>{{ module.name }}</td>

                <td class="text-center">
                  <div class="form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="perm_{{ module.id }}_view"
                     {% if user_permissions[module.id] and user_permissions[module.id].view %}
                     checked

                {% endif %}
>
                  </div>
                </td>

                <td class="text-center">
                  <div class="form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="perm_{{ module.id }}_add"
                      {% if user_permissions[module.id].add %}checked{% endif %}>
                  </div>
                </td>

                <td class="text-center">
                  <div class="form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="perm_{{ module.id }}_change"
                      {% if user_permissions[module.id].change %}checked{% endif %}>
                  </div>
                </td>

                <td class="text-center">
                  <div class="form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="perm_{{ module.id }}_delete"
                      {% if user_permissions[module.id].delete %}checked{% endif %}>
                  </div>
                </td>

              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Bot贸n Guardar -->
        <div class="row mt-3">
          <div class="col-sm-10 offset-sm-2">
            <button type="submit" class="btn btn-primary">Guardar Permisos</button>
          </div>
        </div>

      </div>
    </div>
  </form>
</div>
{% endblock %}
