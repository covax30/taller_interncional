{% extends 'home.html' %}
{% load static %}
{% block body %}
<body class="layout-fixed sidebar-expand-lg sidebar-mini bg-body-tertiary">
  <div class="app-wrapper"> 
    {% include 'header.html' %}
    {% include 'sidebar.html' %}

    {% block content %}
    {% endblock %}

    {% include 'footer.html'%}
  </div>

  <!-- Scripts JS (en orden correcto) -->

  <!-- jQuery (asegúrate de no duplicarlo) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>

  <!-- Popper -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" crossorigin="anonymous"></script>

  <!-- AdminLTE -->
  <script src="{% static 'lib/AdminLTE-4.0.0-rc3/dist/js/adminlte.min.js' %}"></script>

  <!-- OverlayScrollbars -->
  <script src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/browser/overlayscrollbars.browser.es6.min.js" crossorigin="anonymous"></script>

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="{% static 'lib/datatables-1.10.20/datatables.min.css' %}">

  <!-- DataTables JS -->
  <script src="{% static 'lib/datatables-1.10.20/datatables.min.js' %}"></script>

  <!-- Inicialización de DataTables -->
  <script>
    $(document).ready(function () {
      $('#mi-tabla').DataTable(); // Asegúrate de que tu tabla tenga id="mi-tabla"
    });
  </script>

  <!-- Configuración de OverlayScrollbars -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const sidebarWrapper = document.querySelector(".sidebar-wrapper");
      if (sidebarWrapper && OverlayScrollbarsGlobal?.OverlayScrollbars !== undefined) {
        OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
          scrollbars: {
            theme: "os-theme-light",
            autoHide: "leave",
            clickScroll: true
          }
        });
      }
    });
  </script>

  <!-- Corrección de rutas de imágenes -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const cssLink = document.querySelector('link[href*="css/adminlte.css"]');
      if (!cssLink) return;
      const cssHref = cssLink.getAttribute('href');
      const deploymentPath = cssHref.slice(0, cssHref.indexOf('css/adminlte.css'));

      document.querySelectorAll('img[src^="/assets/"]').forEach(img => {
        const originalSrc = img.getAttribute('src');
        if (originalSrc) {
          const relativeSrc = originalSrc.slice(1);
          img.src = deploymentPath + relativeSrc;
        }
      });
    });
  </script>

</body>
{% endblock %}